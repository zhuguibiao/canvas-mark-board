!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();const t={_events:Object.create(null),on(t,i){this._events[t]?this._events[t].push(i):this._events[t]=[i]},on_(t,i,s){return s&&(i=i.bind(s)),this.on(t,i),{type:t,listener:i}},off(t,i){this._events[t]&&(this._events[t]=this._events[t].filter((t=>t!==i)))},off_(t){if(!t)return;const i=t instanceof Array?t:[t];i.forEach((t=>this.off(t.type,t.listener))),i.length=0},emit(t,...i){this._events[t]&&this._events[t].forEach((t=>t.call(this,...i)))}};const i=["destroy","constructor"];const s={};const e={set(t,i=1,s=0,e=0,o=1,n=0,h=0){t.a=i,t.b=s,t.c=e,t.d=o,t.e=n,t.f=h},get:function(){return{a:1,b:0,c:0,d:1,e:0,f:0}},translateInner(t,i,s){t.e+=t.a*i+t.c*s,t.f+=t.b*i+t.d*s},scale(t,i,s=i){t.a*=i,t.b*=i,t.c*=s,t.d*=s},scaleOfInner(t,i,s,e=s){o.translateInner(t,i.x,i.y),o.scale(t,s,e),o.translateInner(t,-i.x,-i.y)},scaleOfOuter(t,i,e,n=e){o.toInnerPoint(t,i,s),o.scaleOfInner(t,s,e,n)},toInnerPoint(t,i,s,e){const{x:o,y:n}=i,{a:h,b:r,c:a,d:l}=t,c=1/(h*l-r*a);if(s||(s=i),s.x=(o*l-n*a)*c,s.y=(n*h-o*r)*c,!e){const{e:i,f:e}=t;s.x-=(i*l-e*a)*c,s.y-=(e*h-i*r)*c}}},o=e;function n(t,i,s,e){let o=1/0,n=-1;return i.forEach(((i,s)=>{let e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));e<o&&(o=e,n=s)})),o<s/e?n:-1}const h=(t,i,s=50,e=40)=>{const{x:o,y:n}=t,{x:h,y:r}=i;let a=Math.atan2(r-n,h-o);return[{x:h-s*Math.cos(a+e*Math.PI/180),y:r-s*Math.sin(a+e*Math.PI/180)},{x:h-s*Math.cos(a-e*Math.PI/180),y:r-s*Math.sin(a-e*Math.PI/180)}]},r=(t,i)=>Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2));function a(t,i){return t.x===i.x&&t.y===i.y}function l(t,i){let s=!1,e=1/0;for(let o=0,n=i.length-1;o<i.length;n=o++){const h=i[o].x,r=i[o].y,a=i[n].x,l=i[n].y;r>t.y!=l>t.y&&t.x<(a-h)*(t.y-r)/(l-r)+h&&(s=!s);const c=a-h,p=l-r,x=((t.x-h)*c+(t.y-r)*p)/(c*c+p*p),d=Math.max(0,Math.min(1,x)),u=h+d*c,y=r+d*p,L=Math.sqrt((t.x-u)**2+(t.y-y)**2);L<e&&(e=L)}return s?-e:e}function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))}const p=Object.freeze(Object.defineProperty({__proto__:null,MatrixHelper:e,getArrow:h,getDistance:r,getMinDistance:n,getSides:(t,i)=>{const{x:s,y:e}=t,{x:o,y:n}=i;return[{x:(s+o)/2-(e-n)/6,y:(e+n)/2+(s-o)/6},{x:(s+o)/2+(e-n)/6,y:(e+n)/2-(s-o)/6}]},getUUID:c,isPointInPolygon:l,isSamePoint:a},Symbol.toStringTag,{value:"Module"}));class x{}let d=class extends x{constructor(t){super(),this.config=t}get __tag(){return"Circle"}draw(){const{center:t,radius:i,fillColor:s="black",ctx:e}=this.config,{x:o,y:n}=t;e.save(),e.beginPath(),e.fillStyle=s,e.arc(o,n,i,0,2*Math.PI),e.fill(),e.closePath(),e.restore()}};class u{constructor(){this.id="",this.group=[],this.pointList=[],this.oldPointList=[],this.label="",this.color="#ff0000",this.index=1,this.boxEventIds=[],this.status="draw",this.completeing=!1,this.expent=5,this.mouseDown=!1,this.lastMousePoint={x:0,y:0},this.acctivePointIndex=-1}setSelect(t){this.box.selectObject&&(this.box.selectObject.status="done",this.box.selectObject.render(),this.box.selectObject=void 0),this.status=t?"edit":"done",this.box.selectObject=this,this.render(),this.box.emit("onchange")}}let y=class extends u{constructor(t){super(),this.completeOffset=30,this.id=c(),this.minPointCount=2,this.box=t,this.index=t.markObjectList.length+1}boxMousedown(t){let i=t;"draw"==this.status&&(this.pointList=[i,i],this.mouseDown=!0),this.box.selectObject&&this.box.selectObject.id===this.id&&this.isPointInside(i)&&(this.mouseDown=!0,this.lastMousePoint=this.box.lastPoint)}setCursor(){}setMoveEdit(t){}boxMousemove(){var t;if((!this.box.selectObject||this.box.selectObject.id==this.id)&&1!=this.completeing)if("draw"==this.status&&this.pointList[0]&&(this.pointList[1]=this.box.lastPoint,this.render()),this.setCursor(),(null==(t=this.box.selectObject)?void 0:t.id)===this.id&&this.mouseDown&&"edit"==this.status){let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):this.setMoveEdit(t),this.lastMousePoint=this.box.lastPoint,this.render()}else"edit"==this.status&&(this.acctivePointIndex=n(this.box.lastPoint,this.vertexList,this.expent,this.box.t.a),this.render())}boxMouseup(){if(this.mouseDown&&"edit"==this.status&&this.acctivePointIndex>-1&&(this.box.selectObject=this),this.box.selectObject){if(this.box.selectObject.id!=this.id)return;this.box.selectObject.id===this.id&&(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=n(this.lastMousePoint,this.vertexList,this.expent,this.box.t.a),this.render(),this.box.render())}else"draw"!==this.status&&(this.status="done");this.mouseDown=!1,"draw"==this.status&&2===this.pointList.length&&this.complete()}destory(){this.pointList=[],this.removeAll()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}async complete(){if(this.pointList.length<this.minPointCount)return;if(Math.max(Math.abs(this.pointList[0].x-this.pointList[1].x),Math.abs(this.pointList[0].y-this.pointList[1].y))<this.completeOffset)return this.status="draw",this.pointList=[],void this.render();this.completeing=!0;let t=await new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.color=null==t?void 0:t.color,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}get vertexList(){return this.pointList}get resultPoints(){return this.pointList}get pathData(){let t="";return this.pointList.length&&(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get indexPoint(){return this.pointList[0]}render(){this.removeAll();let{config:t,regionCtx:i,t:{a:s}}=this.box;this.box.selectObject||this.box.clearCanvas(i),i.lineWidth=t.lineWidth/s,i.strokeStyle="draw"===this.status?t.drawColor:this.color;let e=new Path2D(this.pathData);this.group.push(e),"draw"===this.status&&i.stroke(e),"edit"===this.status&&(this.box.clearCanvas(i),i.stroke(e),i.fillStyle="edit"===this.status?t.fillColor:"rgba(0,0,0,0)",i.fill(e),this.vertexList.map(((t,e)=>{let o=null;o=this.acctivePointIndex===e?new d({ctx:i,center:t,radius:8/s,fillColor:this.color}):new d({ctx:i,center:t,radius:4/s,fillColor:this.color}),o.draw(),this.group.push(o)})))}isPointInside(t){if(!this.pointList.length||"draw"===this.status)return!1;let i=this.expent/this.box.t.a;return l(t,this.vertexList)<i}static import(t,i){let s=new this(t);return s.label=i.label,s.color=i.color||s.color,s.pointList=i.pointList,s.status="done",s.render(),s}};class L extends y{constructor(t){super(t),this.type=v.LINE,this.completeOffset=2}setMoveEdit(){this.pointList[this.acctivePointIndex]={x:this.lastMousePoint.x,y:this.lastMousePoint.y}}isPointInside(t){let i=this.expent/this.box.t.a;return l(t,this.pointList)<i}}let b=class extends u{constructor(t){super(),this.isClosed=!1,this.maxPointCount=1/0,this.drag=!1,this.minPointCount=2,this.id=c(),this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("oncontextmenu",this.boxContextmenu,this)]}boxContextmenu(){"draw"===this.status&&(this.pointList.pop(),this.render())}async boxMousedown(t){if(!this.lastPointDown||!a(t,this.lastPointDown)){if(this.box.selectObject){if(this.box.selectObject.id!==this.id)return;this.isPointInside(t)&&(this.mouseDown=!0),this.lastMousePoint=this.box.lastPoint}if("draw"==this.status){if(this.lastPointDown=t,this.pointList.length>=this.minPointCount&&this.isClosed){let i=2,s={x:t.x-this.pointList[0].x,y:t.y-this.pointList[0].y};if(Math.abs(s.x)<4*i&&Math.abs(s.y)<4*i)return void(await this.complete())}this.pointList.push(t)}}}boxMousemove(){if(!this.box.selectObject||this.box.selectObject.id==this.id){if(this.mouseDown&&"edit"==this.status){this.drag=!0;let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):this.pointList[this.acctivePointIndex]={x:this.lastMousePoint.x,y:this.lastMousePoint.y},this.lastMousePoint=this.box.lastPoint}else"edit"==this.status&&(this.acctivePointIndex=n(this.box.lastPoint,this.pointList,this.expent,this.box.t.a));"done"!==this.status&&this.render()}}boxMouseup(){if(this.box.selectObject){if(this.box.selectObject.id===this.id?(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=n(this.lastMousePoint,this.pointList,this.expent,this.box.t.a)):"draw"!=this.status&&(this.status="done"),"draw"===this.status&&this.box.selectObject.id!==this.id)return this.pointList=[],void(this.mouseDown=!1);this.render()}else if("edit"===this.status)this.status="done",this.box.render();else if("draw"===this.status){if(this.pointList.length===this.maxPointCount)return void this.complete();this.render()}this.drag&&"edit"==this.status&&this.box.render(),this.drag=!1,this.mouseDown=!1}destory(){this.box.off_(this.boxEventIds),this.pointList=[],this.removeAll()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}async complete(){if(this.pointList.length<this.minPointCount)return;this.completeing=!0;let t=await new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.color=null==t?void 0:t.color,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}get pathData(){let t="";return this.pointList.length&&(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get indexPoint(){return this.pointList[0]}get resultPoints(){return this.pointList}render(){this.removeAll();let{config:t,regionCtx:i,t:{a:s}}=this.box;if(this.box.selectObject||this.box.clearCanvas(i),i.lineWidth=t.lineWidth/s,i.strokeStyle="draw"===this.status?t.drawColor:this.color,"draw"===this.status){let t=this.pathData;this.pointList.length>=2&&(t+=`\n        M${this.pointList[this.pointList.length-1].x},\n        ${this.pointList[this.pointList.length-1].y}\n        L${this.pointList[this.pointList.length-1].x},\n        ${this.pointList[this.pointList.length-1].y} Z`),t+=`L${this.box.lastPoint.x},${this.box.lastPoint.y} Z`;let e=new Path2D(t);this.group.push(e),i.stroke(e),this.pointList.map((t=>{let e=null;e=new d({ctx:i,center:t,radius:4/s,fillColor:this.color}),this.group.push(e),e.draw()}))}if("edit"===this.status){this.box.clearCanvas(i);let e=new Path2D(this.pathData);this.group.push(e),i.stroke(e),i.fillStyle="edit"===this.status?t.fillColor:"rgba(0,0,0,0)",i.fill(new Path2D(this.pathData)),this.pointList.map(((t,e)=>{let o=null;o=this.acctivePointIndex===e?new d({ctx:i,center:t,radius:8/s,fillColor:this.color}):new d({ctx:i,center:t,radius:4/s,fillColor:this.color}),this.group.push(o),o.draw()}))}}isPointInside(t){let i=this.expent/this.box.t.a;return l(t,this.pointList)<i}static import(t,i){let s=new this(t);return s.label=i.label,s.color=i.color||s.color,s.pointList=i.pointList,s.status="done",s.render(),s}};var v=(t=>(t.NONE="",t.RECT="rect",t.POLYGON="polygon",t.CIRCLE="circle",t.ELLIPSE="ellipse",t.POINT="point",t.LINE="line",t.POLYLINE="polyline",t.LINE_ARROW="line_arrow",t))(v||{});const g={"":"",rect:class extends y{constructor(t){super(t),this.type=v.RECT,this.minPointCount=2}setCursor(){-1!==this.acctivePointIndex&&(this.box.view.style.cursor=["nwse-resize","nesw-resize","nwse-resize","nesw-resize"][this.acctivePointIndex])}setMoveEdit(){let t,i={...this.vertexList[this.acctivePointIndex]};0==this.acctivePointIndex?t={...this.vertexList[2]}:1==this.acctivePointIndex?t={...this.vertexList[3]}:2==this.acctivePointIndex?t={...this.vertexList[0]}:3==this.acctivePointIndex&&(t={...this.vertexList[1]}),i={...this.box.lastPoint};let s=Math.min(i.x,t.x),e=Math.min(i.y,t.y),o=Math.max(i.x,t.x),n=Math.max(i.y,t.y);this.pointList=[{x:s,y:e},{x:o,y:n}],this.acctivePointIndex=this.vertexList.findIndex((t=>t.x==i.x&&t.y==i.y))}get pathData(){let t="";return this.vertexList.length&&(this.vertexList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get vertexList(){return 2===this.pointList.length?[this.pointList[0],{x:this.pointList[0].x,y:this.pointList[1].y},this.pointList[1],{x:this.pointList[1].x,y:this.pointList[0].y}]:[]}},polygon:class extends b{constructor(t){super(t),this.type=v.POLYGON,this.minPointCount=3,this.isClosed=!0}},circle:class extends y{constructor(t){super(t),this.type=v.CIRCLE}setCursor(){1===this.acctivePointIndex&&(this.box.view.style.cursor="col-resize")}setMoveEdit(t){this.pointList[1]={x:this.pointList[1].x+t.x,y:this.pointList[1].y+t.y}}get vertexList(){return 2===this.pointList.length?[this.pointList[1]]:[]}get indexPoint(){var t;return null==(t=this.pointList)?void 0:t[1]}get pathData(){let t="";if(this.pointList.length){let i={x:2*this.pointList[0].x-this.pointList[1].x,y:2*this.pointList[0].y-this.pointList[1].y},s=r(this.pointList[0],this.pointList[1]);t+=`\n          M ${i.x} ${i.y} \n          A ${s} ${s} 0 0 1 ${this.pointList[1].x} ${this.pointList[1].y}\n          A ${s} ${s} 0 0 1 ${i.x} ${i.y}\n        `,t+="Z "}return t}isPointInside(t){let i=this.expent/this.box.initLayout.zoom;if(!this.pointList.length||"draw"===this.status)return!1;let s=Math.sqrt(Math.pow(this.pointList[0].x-t.x,2)+Math.pow(this.pointList[0].y-t.y,2)),e=r(this.pointList[0],this.pointList[1]);return s<=e+i&&0!==e}},ellipse:class extends y{constructor(t){super(t),this.type=v.ELLIPSE}setCursor(){[0,2].includes(this.acctivePointIndex)?this.box.view.style.cursor="col-resize":[1,3].includes(this.acctivePointIndex)&&(this.box.view.style.cursor="row-resize")}setMoveEdit(t){0===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x-t.x,y:this.pointList[1].y}:1===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x,y:this.pointList[1].y+t.y}:2===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x+t.x,y:this.pointList[1].y}:3===this.acctivePointIndex&&(this.pointList[1]={x:this.pointList[1].x,y:this.pointList[1].y-t.y})}get vertexList(){if(2===this.pointList.length){let t=this.pointList[1].x-this.pointList[0].x,i=this.pointList[1].y-this.pointList[0].y;return[{x:this.pointList[0].x-t,y:this.pointList[0].y},{x:this.pointList[0].x,y:this.pointList[0].y+i},{x:this.pointList[1].x,y:this.pointList[1].y-i},{x:this.pointList[0].x,y:this.pointList[0].y-i}]}return[]}get ellipseData(){if(2===this.pointList.length){let t=Math.abs(this.pointList[1].x-this.pointList[0].x),i=Math.abs(this.pointList[1].y-this.pointList[0].y);return{pointList:this.pointList[0],xr:t,yr:i}}return null}get indexPoint(){return this.vertexList[1]}get pathData(){let t="";if(this.pointList.length){let i=Math.abs(this.pointList[1].x-this.pointList[0].x),s=Math.abs(this.pointList[1].y-this.pointList[0].y);t+=`\n        M ${this.vertexList[0].x} ${this.vertexList[0].y} \n        A ${i} ${s} 0 0 1 ${this.vertexList[2].x} ${this.vertexList[2].y}\n        A ${i} ${s} 0 0 1 ${this.vertexList[0].x} ${this.vertexList[0].y}\n      `,t+="Z "}return t}isPointInside(t){if(!this.pointList.length||"draw"===this.status)return!1;const{xr:i,yr:s,pointList:e}=this.ellipseData;return(t.x-e.x)**2/i**2+(t.y-e.y)**2/s**2<=1||n(t,this.vertexList,this.expent,this.box.t.a)>-1}},polyline:class extends b{constructor(t){super(t),this.type=v.POLYLINE,this.minPointCount=3}get pathData(){let t="";return this.pointList.length&&this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t}},line:L,line_arrow:class extends L{constructor(t){super(t),this.type=v.LINE_ARROW}get pathData(){let t="";if(this.pointList.length){if(2===this.pointList.length&&this.pointList[0].x!=this.pointList[1].x&&this.pointList[0].y!=this.pointList[1].y){t+=`M${this.pointList[0].x},${this.pointList[1].y}`,t+=`L${this.pointList[0].x},${this.pointList[1].y}`;const[i,s]=this.pointList,[e,o]=h(i,s,20/this.box.t.a);t+="Z",t+=`M${i.x},${i.y}`,t+=`L${s.x},${s.y}`,t+="Z",t+=`M${e.x},${e.y}`,t+=`L${s.x},${s.y}`,t+=`M${s.x},${s.y}`,t+=`L${o.x},${o.y}`,t+="Z"}t+="Z "}return t}}};var f=Object.defineProperty,m=Object.getOwnPropertyDescriptor;const{scaleOfOuter:w}=e;let M=class{constructor(t){this.config={drawColor:"yellow",lineWidth:2,fillColor:"rgba(255, 255, 255, 0.3)",showIndex:!0},this.t={a:1,b:0,c:0,d:1,e:0,f:0},this.initLayout={zoom:1,offsetx:0,offsety:0,width:0,height:0},this.lastMovePoint={x:0,y:0},this.moveStatus=!1,this.mouseDown=!1,this.drag=!1,this.currentDrawingType=v.NONE,this.markObjectList=[],this.renderGroup=[],this.markMap=g,this._events=Object.create(null),this.init(t)}init(t){Object.assign(this.config,t||{}),this.view=document.querySelector(t.view),this.view.style.overflow="hidden",this.view.style.position="relative",this.view.style.cursor="default",this.canvas=this.createCanvas(),this.regionCanvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.regionCtx=this.regionCanvas.getContext("2d"),this.view.addEventListener("mousemove",this.appMousemove.bind(this)),this.view.addEventListener("mousedown",this.appMousedown.bind(this)),this.view.addEventListener("mouseup",this.appMouseup.bind(this)),this.view.addEventListener("wheel",this.appWheel.bind(this)),this.view.addEventListener("dblclick",this.appDblclick.bind(this)),this.view.addEventListener("contextmenu",(t=>{t.preventDefault(),this.emit("oncontextmenu",this.lastMovePoint)})),this.windowKeydown=this.windowKeydown.bind(this),this.windowKeyup=this.windowKeyup.bind(this),window.addEventListener("keydown",this.windowKeydown),window.addEventListener("keyup",this.windowKeyup)}register(t,i){if(!t||!i)throw new Error("need type or markObject");this.markMap[t]=i}get viewDomInfo(){return this.view.getBoundingClientRect()}get lastPoint(){return this.lastMovePoint?this.lastMovePoint:null}createCanvas(){let t=document.createElement("canvas");return t.setAttribute("style",` width: ${this.viewDomInfo.width}px;\n        height: ${this.viewDomInfo.height}px;\n        position: absolute;\n        `),t.width=this.viewDomInfo.width,t.height=this.viewDomInfo.height,this.view.appendChild(t),t}clearCanvas(t){t.save(),t.globalCompositeOperation="copy",t.beginPath(),t.lineTo(0,0),t.stroke(),t.restore()}clearMarkShapes(){this.markObjectList.forEach((t=>{t.destory(),t.render()})),this.markObjectList=[],this.render(),this.emit("onchange"),this.addObjectData()}async setBackground(t){return new Promise((i=>{var s;(null==(s=this.img)?void 0:s.src)?this.img.src=t:(this.img=new Image,this.img.src=t,this.img.style.position="absolute",this.img.style.userSelect="none",this.img.style.pointerEvents="none"),this.img.onload=()=>{this.view.insertBefore(this.img,this.canvas),this.setLayout(this.img),i(null)}}))}transfrom(){var t;this.ctx.setTransform(this.t),this.regionCtx.setTransform(this.t),this.img&&this.imgTrans(),null==(t=this.selectObject)||t.render(),this.render(),this.emit("ontransform",{t:this.t})}setLayout({width:t,height:i}){let s=this.viewDomInfo.width/t,e=this.viewDomInfo.height/i,o=Math.min(s,e),n=(this.viewDomInfo.width-t*o)/2,h=(this.viewDomInfo.height-i*o)/2;this.t={a:o,b:0,c:0,d:o,e:n,f:h},this.initLayout={zoom:o,offsetx:n,offsety:h,width:t,height:i},this.transfrom()}imgTrans(){this.img.style.transformOrigin=`${this.t.e}px ${this.t.f}px`,this.img.style.transform=`scale(${this.t.a}) translate(${this.t.e}px,${this.t.f}px)`}render(){for(var t=0;t<this.renderGroup.length;t++)this.renderGroup[t]=null;this.renderGroup=[],this.clearCanvas(this.ctx),this.ctx.font=`bold ${~~(16/this.t.a)}px serif`,this.ctx.lineWidth=this.config.lineWidth/this.t.a,this.markObjectList.map(((t,i)=>{"draw"!==t.status&&this.config.showIndex&&this.ctx.fillText(i+"",t.indexPoint.x,t.indexPoint.y-3/this.t.a),this.ctx.strokeStyle=t.color;let s=new Path2D(t.pathData);this.renderGroup.push(s),this.ctx.stroke(s)}))}appWheel(t){if(!this.config.disableZoom&&(t.metaKey||t.ctrlKey||t.altKey)){t.preventDefault();const i={x:t.offsetX,y:t.offsetY};let s=t.deltaY>0?.9:1.1;w(this.t,i,s,s),this.transfrom()}}appDblclick(){this.t={a:this.initLayout.zoom,b:0,c:0,d:this.initLayout.zoom,e:this.initLayout.offsetx,f:this.initLayout.offsety},this.transfrom()}appMoving(t){if(this.config.disableMove)return;this.view.style.cursor="grab";let i=(t.x-this.lastMovePoint.x)*this.t.a,s=(t.y-this.lastMovePoint.y)*this.t.a;this.t.e+=i,this.t.f+=s,this.transfrom(),this.emit("onmove",{status:this.moveStatus})}appMousemove(t){let i=this.pointMapping(t);if(this.mouseDown&&this.moveStatus)return this.appMoving(i),void(this.lastMovePoint=this.pointMapping(t));this.view.style.cursor="default",!!this.markObjectList.find((t=>"draw"===t.status))&&(this.view.style.cursor="crosshair"),this.mouseDown&&this.selectObject&&(this.drag=!0,this.view.style.cursor="move"),void 0!==t.buttons&&(this.lastMovePoint={x:i.x,y:i.y}),this.getDrawMark("boxMousemove",i)}appMousedown(t){let i=this.pointMapping(t);this.mouseDown=!0,this.moveStatus||1===t.buttons&&this.getDrawMark("boxMousedown",i)}getDrawMark(t,i){var s,e;this.selectObject&&this.selectObject[t](i);const o=this.markObjectList[this.markObjectList.length-1];o&&"draw"==o.status&&(null==(e=null==(s=this.markObjectList)?void 0:s[this.markObjectList.length-1])||e[t](i))}appMouseup(t){var i,s,e,o,n,h,r;if(this.mouseDown=!1,this.moveStatus)return;let a=this.pointMapping(t);if(this.selectObject&&this.drag)return this.selectObject.isPointInside(a)||-1!==this.selectObject.acctivePointIndex||(this.selectObject=void 0),this.drag=!1,this.getDrawMark("boxMouseup",a),void this.emit("onchange");let l=this.markObjectList[this.markObjectList.length-1];if("draw"===l.status&&l.pointList&&(null==(i=this.lastMovePoint)?void 0:i.x)!==(null==(e=null==(s=null==l?void 0:l.pointList)?void 0:s[0])?void 0:e.x)&&l.pointList.length>0&&(null==(n=null==(o=null==l?void 0:l.pointList)?void 0:o[0])?void 0:n.x)!==(null==(r=null==(h=null==l?void 0:l.pointList)?void 0:h[1])?void 0:r.x))this.selectObject=void 0;else{let t=this.getSelectedIndex(a);void 0!==t&&this.markObjectList[t]?(this.drag&&this.selectObject&&this.selectObject.id!==this.markObjectList[t].id||(this.selectObject=this.markObjectList[t]),"draw"===this.markObjectList[t].status&&(this.selectObject=void 0)):this.selectObject=void 0}this.moveStatus=!1,this.mouseDown=!1,this.drag=!1,this.getDrawMark("boxMouseup",a),this.emit("onchange")}pointMapping(t){let i={x:0,y:0},s=t.offsetX||t.x,e=t.offsetY||t.y;return i.x=(s-this.t.e)/this.t.a,i.y=(e-this.t.f)/this.t.a,i}getSelectedIndex(t){let i=this.markObjectList.map(((t,i)=>i)).reverse().filter((i=>this.markObjectList[i].isPointInside(t)));if(i.length){if(1===i.length)return i[0];if(i.length>1){if(this.drag&&this.selectObject)return this.selectObject.index-1;if(this.selectObject){const t=this.selectObject.index-1;if(i.indexOf(t)>-1)return i[i.indexOf(t)+1]}if(!this.selectObject)return i[0]}}}async setDrawType(t){if(this.currentDrawingType){let t=this.markObjectList[this.markObjectList.length-1];t&&"draw"===t.status&&(null==t||t.destory(),this.markObjectList.pop())}this.currentDrawingType=t,this.addObjectData(),this.emit("ondraw",{type:t})}get objects(){return this.markObjectList.filter((t=>"draw"!==t.status)).map((t=>{var i;return{id:t.id,label:t.label,type:t.type,color:t.color,select:t.id===(null==(i=this.selectObject)?void 0:i.id),pointList:t.resultPoints||t.pointList}}))}addObjectData(){let t=null;if(this.currentDrawingType)try{t=new this.markMap[this.currentDrawingType](this)}catch(i){throw new Error(`${this.currentDrawingType} mark type is not supported`)}t&&this.markObjectList.push(t),this.emit("onchange")}setObjectData(t){t.forEach((t=>{let i;if(t.type)try{i=this.markMap[t.type].import(this,t)}catch(s){throw new Error(`${t.type} mark type is not supported`)}i&&this.markObjectList.push(i)})),this.render(),this.emit("onchange")}selectObjectById(t){let i=this.markObjectList.find((i=>i.id===t));i&&i.setSelect(!0)}deleteObject(t){var i;let s=this.markObjectList.find((i=>i.id===t));s&&(s.destory(),null==(i=this.selectObject)||i.render(),this.markObjectList.splice(this.markObjectList.indexOf(s),1),this.render(),this.emit("onchange"))}setMoveEditStatus(t){this.moveStatus!=t&&(this.moveStatus=t)}async windowKeydown(t){if("Space"==t.code&&(this.setMoveEditStatus(!0),t.preventDefault()),"NumpadEnter"==t.code||"Enter"==t.code){let t=this.markObjectList[this.markObjectList.length-1];"draw"==(null==t?void 0:t.status)&&await t.complete()}"Delete"==t.code&&this.selectObject&&this.deleteObject(this.selectObject.id)}windowKeyup(t){"Space"==t.code&&this.setMoveEditStatus(!1)}destroy(){window.removeEventListener("keydown",this.windowKeydown),window.removeEventListener("keyup",this.windowKeyup),this.view.innerHTML="",this.view.replaceWith(this.view.cloneNode(!0))}on(t,i){}on_(t,i,s){return{}}off(t,i){}off_(t){}emit(t,...i){}};var P,O;M.MoveMarkObject=y,M.ClickMarkObject=b,M.MarkBoardUtils=p,M=((t,i,s,e)=>{for(var o,n=e>1?void 0:e?m(i,s):i,h=t.length-1;h>=0;h--)(o=t[h])&&(n=(e?o(i,s,n):o(n))||n);return e&&n&&f(i,s,n),n})([(P=t,t=>{var s;(P.prototype?(s=P.prototype,Object.getOwnPropertyNames(s)):Object.keys(P)).forEach((s=>{if(!(i.includes(s)||O&&O.includes(s)))if(P.prototype){const i=function(t,i){return Object.getOwnPropertyDescriptor(t,i)}(P.prototype,s);i.writable&&(t.prototype[s]=P.prototype[s])}else t.prototype[s]=P[s]}))})],M);const $=M,j=""+new URL("image-etDKo1Lq.jpg",import.meta.url).href,I=[{id:"f9e1cf23-8903-4f40-8ff9-724363190272",label:"person",type:"polygon",color:"gray",pointList:[{x:257.7016248153619,y:189.06942392909895},{x:380.5967503692762,y:191.90546528803543},{x:520.5081240768095,y:191.90546528803543},{x:768.1890694239291,y:192.85081240768093},{x:760.6262924667651,y:222.15657311669128},{x:633.0044313146234,y:225.93796159527326},{x:632.0590841949778,y:257.13441654357456},{x:257.7016248153619,y:260.9158050221566}]},{id:"f414b029-1311-43f8-b2e5-fa0508ce5740",label:"women",type:"rect",color:"blue",pointList:[{x:653.8020679468241,y:251.4623338257016},{x:770.07976366322,y:287.3855243722304}]},{id:"b420899a-1488-4885-97a2-c9c4131a08e2",label:"home",type:"circle",color:"pink",pointList:[{x:80.92171344165445,y:460.384047267356},{x:40.27178729689808,y:424.4608567208272}]},{id:"f0b68f67-7af1-4a69-8502-774ab07676cf",label:"cloud",type:"ellipse",color:"#20B4D9",pointList:[{x:144.25997045790254,y:302.51107828655836},{x:232.1772525849335,y:326.1447562776957}]},{id:"b2e9e160-ae8b-4992-a832-6423af623764",label:"person",type:"line",color:"#063D4E",pointList:[{x:126.29837518463813,y:349.77843426883305},{x:576.2836041358936,y:345.0516986706056}]},{id:"9aff9994-991e-44fe-b67e-7b57f31f751f",label:"arrow",type:"line_arrow",color:"#F924d2",pointList:[{x:129.13441654357462,y:66.17429837518463},{x:254.8655834564254,y:162.59970457902511}]},{id:"bb3f20df-1594-4dc8-b3e5-1262a4ae8ea6",label:"person",type:"polyline",color:"#E27A18",pointList:[{x:849.4889217134416,y:42.540620384047266},{x:944.9689807976366,y:127.62186115214179},{x:814.5110782865584,y:160.7090103397341}]}],k=[{viewBox:"0 0 1024 1024",type:"rect",icon:"M904.50393 795.651268V225.084385c32.463366-10.869558 55.862285-41.503253 55.862286-77.623915 0-45.212738-36.647665-81.863473-81.864496-81.863473-35.721573 0-66.084091 22.890336-77.262688 54.798047H226.150158c-11.177574-31.907711-41.538045-54.79907-77.262688-54.79907-45.213761 0-81.864496 36.651758-81.864496 81.864496 0 35.530215 22.63758 65.76175 54.271045 77.086679v571.642379c-31.633465 11.32493-54.271044 41.555441-54.271045 77.084632 0 45.212738 36.652781 81.864496 81.864496 81.864496 34.495652 0 63.98222-21.342074 76.036767-51.532677h577.543786c12.05557 30.190603 41.546232 51.532677 76.035743 51.532677 45.217854 0 81.864496-36.651758 81.864496-81.864496-0.002047-36.120662-23.400966-66.753333-55.864332-77.622892z m-105.182574 56.789401H228.067834c-7.227612-27.548426-28.447912-49.415456-55.609529-57.570183V225.865167c26.077935-7.829316 46.683229-28.300556 54.682414-54.305836H800.249495c7.835456 25.473161 27.768437 45.63434 53.090149 53.80851V795.367813c-26.39516 8.519024-46.930869 30.065759-54.018288 57.072856z"},{viewBox:"0 0 1024 1024",type:"polygon",icon:"M680.71 915.22H343.29c-39.53 0-76.37-21.27-96.12-55.52L78.46 567.49c-19.75-34.22-19.75-76.77 0-110.99l168.71-292.2c19.75-34.24 56.6-55.52 96.12-55.52h337.42c39.53 0 76.37 21.27 96.12 55.52l168.71 292.2c19.75 34.22 19.75 76.77 0 110.99L776.83 859.7c-19.75 34.24-56.59 55.52-96.12 55.52zM343.29 175.69c-15.7 0-30.35 8.43-38.21 22.04l-168.71 292.2c-7.84 13.61-7.84 30.52 0 44.13l168.71 292.2c7.86 13.61 22.51 22.04 38.21 22.04h337.42c15.7 0 30.35-8.43 38.21-22.04l168.71-292.2c7.84-13.61 7.84-30.52 0-44.13l-168.71-292.2c-7.86-13.61-22.51-22.04-38.21-22.04H343.29z"},{viewBox:"0 0 1024 1024",type:"dot",icon:"M512 320a192.064 192.064 0 0 1 0 384 192 192 0 0 1 0-384z"},{viewBox:"0 0 1024 1024",type:"circle",icon:"M512 928C282.624 928 96 741.376 96 512S282.624 96 512 96s416 186.624 416 416-186.624 416-416 416z m0-768C317.92 160 160 317.92 160 512s157.92 352 352 352 352-157.92 352-352S706.08 160 512 160z"},{viewBox:"0 0 1024 1024",type:"ellipse",icon:"M512 838.656c-228.864 0-415.232-146.432-415.232-326.656 0-180.224 186.368-326.656 415.232-326.656 228.864 0 415.232 146.432 415.232 326.656 0 180.224-186.368 326.656-415.232 326.656z m0-589.312c-194.048 0-351.232 117.76-351.232 262.656 0 144.896 157.696 262.656 351.232 262.656s351.232-117.76 351.232-262.656c0-144.896-157.184-262.656-351.232-262.656z"},{viewBox:"0 0 1024 1024",type:"line",icon:"M960 470.857143H64c-5.028571 0-9.142857 4.114286-9.142857 9.142857v64c0 5.028571 4.114286 9.142857 9.142857 9.142857h896c5.028571 0 9.142857-4.114286 9.142857-9.142857v-64c0-5.028571-4.114286-9.142857-9.142857-9.142857z"},{viewBox:"0 0 1024 1024",type:"polyline",icon:"M221.342 686.08l-48.837-33.083 215.04-317.44 184.32 239.065L764.849 335.95l45.686 37.021-239.458 296.96-180.382-233.55L221.342 686.08z"},{viewBox:"0 0 1024 1024",type:"line_arrow",icon:"M593.066667 793.642667a32.170667 32.170667 0 0 1 0-45.226667l236.373333-236.373333L593.066667 275.626667a32 32 0 0 1 45.226666-45.184l258.986667 258.986666a32.170667 32.170667 0 0 1 0 45.226667l-258.986667 258.986667a31.914667 31.914667 0 0 1-45.226666 0z M149.333333 544a32.213333 32.213333 0 0 1-32-32 32.213333 32.213333 0 0 1 32-32h718.08a32.213333 32.213333 0 0 1 32 32 32.213333 32.213333 0 0 1-32 32z"},{viewBox:"0 0 480 480",type:"sides_arrow",icon:" M20 260 H460 V230 H20Z M225 85 V400 H255 V115Z M170 170 L240 100 L220 80 L150 150Z M310 170 L220 80 L240 60 L330 150Z"},{viewBox:"0 0 1024 1024",type:"polyline_arrow",icon:"M593.066667 793.642667a32.170667 32.170667 0 0 1 0-45.226667l236.373333-236.373333L593.066667 275.626667a32 32 0 0 1 45.226666-45.184l258.986667 258.986666a32.170667 32.170667 0 0 1 0 45.226667l-258.986667 258.986667a31.914667 31.914667 0 0 1-45.226666 0z M149.333333 544a32.213333 32.213333 0 0 1-32-32 32.213333 32.213333 0 0 1 32-32h718.08a32.213333 32.213333 0 0 1 32 32 32.213333 32.213333 0 0 1-32 32z"},{viewBox:"0 0 24 24",type:"triangle",icon:"M12 7.77L18.39 18H5.61L12 7.77M12 4L2 20h20L12 4z"}],{ClickMarkObject:D,MoveMarkObject:C,MarkBoardUtils:E}=$;class S{constructor(t){this.config=t}get __tag(){return"Circle"}draw(){const{center:t,radius:i,fillColor:s="black",ctx:e}=this.config,{x:o,y:n}=t;e.save(),e.beginPath(),e.fillStyle=s,e.arc(o,n,i,0,2*Math.PI),e.fill(),e.closePath(),e.restore()}}class _ extends D{constructor(t){super(t),this.type="dot",this.minPointCount=1,this.maxPointCount=1}isPointInside(t){let i=this.expent/this.box.initLayout.zoom;if(!this.pointList.length||"draw"===this.status)return!1;return Math.sqrt(Math.pow(this.pointList[0].x-t.x,2)+Math.pow(this.pointList[0].y-t.y,2))<=4+i&&!0}render(){this.removeAll();let{config:t,regionCtx:i,t:{a:s}}=this.box;this.box.selectObject||this.box.clearCanvas(i),"edit"===this.status&&(this.box.clearCanvas(i),i.fillStyle="edit"===this.status?t.fillColor:"rgba(0,0,0,0)",i.fill(new Path2D(this.pathData)),this.pointList.map(((t,e)=>{let o=null;o=this.acctivePointIndex===e?new S({ctx:i,center:t,radius:8/s,fillColor:this.color}):new S({ctx:i,center:t,radius:6/s,fillColor:this.color}),o.draw()})))}get pathData(){let t="";if(this.pointList.length){let i={x:this.pointList[0].x-4,y:this.pointList[0].y},s={x:this.pointList[0].x+4,y:this.pointList[0].y},e=((t,i)=>Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)))(this.pointList[0],i);t+=`\n          M ${i.x} ${i.y} \n          A ${e} ${e} 0 0 1 ${s.x} ${s.y}\n          A ${e} ${e} 0 0 1 ${i.x} ${i.y}\n        `,t+="Z "}return t}}class z extends C{constructor(t){super(t),this.type="sides_arrow"}setMoveEdit(){this.pointList[this.acctivePointIndex]={x:this.lastMousePoint.x,y:this.lastMousePoint.y}}isPointInside(t){let i=this.expent/this.box.t.a;return E.isPointInPolygon(t,this.pointList)<i}get pathData(){let t="";if(2===this.pointList.length&&this.pointList[0].x!=this.pointList[1].x&&this.pointList[0].y!=this.pointList[1].y){t+=`M${this.pointList[0].x},${this.pointList[1].y}`,t+=`L${this.pointList[0].x},${this.pointList[1].y}`;const[i,s]=E.getSides(this.pointList[0],this.pointList[1]),[e,o]=E.getArrow(s,i,20/this.box.t.a);t+="Z",t+=`M${s.x},${s.y}`,t+=`L${i.x},${i.y}`,t+="Z",t+=`M${e.x},${e.y}`,t+=`L${i.x},${i.y}`,t+=`M${i.x},${i.y}`,t+=`L${o.x},${o.y}`,t+="Z",t+=`M${this.pointList[0].x},${this.pointList[0].y}`,t+=`L${this.pointList[1].x},${this.pointList[1].y}`,t+=`L${this.pointList[0].x},${this.pointList[0].y} `,t+=`L${this.pointList[this.pointList.length-1].x},${this.pointList[this.pointList.length-1].y} `,t+="Z "}return t}}class B extends D{constructor(t){super(t),this.type="polyline_arrow"}get pathData(){let t="";if(this.pointList.length&&(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),this.pointList.length>=2))for(let i=0;i<this.pointList.length-1;i++){const[s,e]=E.getArrow(this.pointList[i],this.pointList[i+1],20/this.box.t.a);t+=`M${s.x},${s.y}`,t+=`L${this.pointList[i+1].x},${this.pointList[i+1].y}`,t+=`M${this.pointList[i+1].x},${this.pointList[i+1].y}`,t+=`L${e.x},${e.y}`,t+=`M${this.pointList[i+1].x},${this.pointList[i+1].y}`}return t}}class T extends C{constructor(t){super(t),this.type="triangle"}setMoveEdit(t){0==this.acctivePointIndex?this.pointList[0]={x:this.pointList[0].x+t.x,y:this.pointList[0].y+t.y}:1===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x+t.x,y:this.pointList[1].y+t.y}:2===this.acctivePointIndex&&(this.pointList[0]={x:this.pointList[0].x+t.x,y:this.pointList[0].y},this.pointList[1]={x:this.pointList[1].x,y:this.pointList[1].y+t.y})}get pathData(){let t="";return this.vertexList.length&&(this.vertexList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get vertexList(){return 2===this.pointList.length?[{x:(this.pointList[0].x+this.pointList[1].x)/2,y:this.pointList[0].y},this.pointList[1],{x:this.pointList[0].x,y:this.pointList[1].y}]:[]}get indexPoint(){return this.vertexList[0]}get resultPoints(){return this.vertexList}}window.onload=function(){let t;document.getElementById("upload").onclick=function(){let i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=function(i){let s=i.target.files[0];if(s){let i=new FileReader;i.onload=function(i){null==t||t.setBackground(i.target.result).then((()=>{t.setDrawType(t.currentDrawingType||"rect")}))},i.readAsDataURL(s)}},i.click()},document.getElementById("clear").onclick=function(){t.clearMarkShapes()},document.getElementById("importJson").onclick=function(){t.setObjectData(I)},document.getElementById("creact").onclick=r,document.getElementById("destroy").onclick=function(){t.destroy(),t=void 0};let i=[],s=document.querySelector("#labelInput"),e=document.querySelector("#colorInput"),o=document.querySelector("#textarea"),n=s.value,h=e.value;function r(){t||(t=new $({view:"#mark-box",showIndex:!1}),t.register("sides_arrow",z),t.register("polyline_arrow",B),t.register("triangle",T),t.register("dot",_),null==t||t.setBackground(j).then((()=>{t.setDrawType(t.currentDrawingType||"rect")})),t.on("ondraw",(i=>{t.currentDrawingType=i.type})),t.on("oncomplete",(t=>{t.ok({label:n,color:h})})),t.on("onchange",(()=>{i=t.objects,function(){var s=document.getElementById("mark-list"),e=[];e.push("<ul id='mark-list-ul'>");for(var o=0;o<i.length;o++){var n=i[o].label;e.push(`<li>\n        ${n}\n      <button data-type='del' data-id=${i[o].id}>删除</button>\n      </li>`)}e.push("</ul>"),s.innerHTML=e.join(""),document.getElementById("mark-list-ul").onclick=i=>{if(i.target.dataset.type&&"del"===i.target.dataset.type)t.deleteObject(i.target.dataset.id)}}(),o.value=JSON.stringify(i)})))}s.onchange=t=>{n=t.target.value},e.onchange=t=>{h=t.target.value},function(){const t=document.querySelector(".mark-shape-list");let i=[];for(let s=0;s<k.length;s++){const t=k[s];i.push(`\n        <button data-type="${t.type}">\n          <svg data-type="${t.type}" viewBox="${t.viewBox}" version="1.1" xmlns="http://www.w3.org/2000/svg">\n            <path data-type="${t.type}"\n              d="${t.icon}"\n              fill="#333333"></path>\n          </svg>\n        </button>`)}t.innerHTML=i.join("")}(),r(),document.querySelector(".mark-operate").onclick=function(i){i.target.dataset.type&&t.setDrawType(i.target.dataset.type)}};
