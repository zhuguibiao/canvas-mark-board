function t(t,i,s,e){return new(s||(s=Promise))((function(o,n){function h(t){try{a(e.next(t))}catch(i){n(i)}}function r(t){try{a(e.throw(t))}catch(i){n(i)}}function a(t){var i;t.done?o(t.value):(i=t.value,i instanceof s?i:new s((function(t){t(i)}))).then(h,r)}a((e=e.apply(t,i||[])).next())}))}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}(),"function"==typeof SuppressedError&&SuppressedError;const i={_events:Object.create(null),on(t,i){this._events[t]?this._events[t].push(i):this._events[t]=[i]},on_(t,i,s){return s&&(i=i.bind(s)),this.on(t,i),{type:t,listener:i}},off(t,i){this._events[t]&&(this._events[t]=this._events[t].filter((t=>t!==i)))},off_(t){if(!t)return;const i=t instanceof Array?t:[t];i.forEach((t=>this.off(t.type,t.listener))),i.length=0},emit(t,...i){this._events[t]&&this._events[t].forEach((t=>t.call(this,...i)))}},s=["destroy","constructor"];class e{}class o extends e{constructor(t){super(),this.config=t}get __tag(){return"Circle"}draw(){const{center:t,radius:i,fillColor:s="black",ctx:e}=this.config,{x:o,y:n}=t;e.save(),e.beginPath(),e.fillStyle=s,e.arc(o,n,i,0,2*Math.PI),e.fill(),e.closePath(),e.restore()}}const n={},h={set(t,i=1,s=0,e=0,o=1,n=0,h=0){t.a=i,t.b=s,t.c=e,t.d=o,t.e=n,t.f=h},get:function(){return{a:1,b:0,c:0,d:1,e:0,f:0}},translateInner(t,i,s){t.e+=t.a*i+t.c*s,t.f+=t.b*i+t.d*s},scale(t,i,s=i){t.a*=i,t.b*=i,t.c*=s,t.d*=s},scaleOfInner(t,i,s,e=s){r.translateInner(t,i.x,i.y),r.scale(t,s,e),r.translateInner(t,-i.x,-i.y)},scaleOfOuter(t,i,s,e=s){r.toInnerPoint(t,i,n),r.scaleOfInner(t,n,s,e)},toInnerPoint(t,i,s,e){const{x:o,y:n}=i,{a:h,b:r,c:a,d:l}=t,c=1/(h*l-r*a);if(s||(s=i),s.x=(o*l-n*a)*c,s.y=(n*h-o*r)*c,!e){const{e:i,f:e}=t;s.x-=(i*l-e*a)*c,s.y-=(e*h-i*r)*c}}},r=h;function a(t,i,s,e){let o=1/0,n=-1;return i.forEach(((i,s)=>{let e=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));e<o&&(o=e,n=s)})),o<s/e?n:-1}const l=(t,i,s=50,e=40)=>{const{x:o,y:n}=t,{x:h,y:r}=i;let a=Math.atan2(r-n,h-o);return[{x:h-s*Math.cos(a+e*Math.PI/180),y:r-s*Math.sin(a+e*Math.PI/180)},{x:h-s*Math.cos(a-e*Math.PI/180),y:r-s*Math.sin(a-e*Math.PI/180)}]},c=(t,i)=>Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2));function d(t,i){return t.x===i.x&&t.y===i.y}function x(t,i){let s=!1,e=1/0;for(let o=0,n=i.length-1;o<i.length;n=o++){const h=i[o].x,r=i[o].y,a=i[n].x,l=i[n].y;r>t.y!=l>t.y&&t.x<(a-h)*(t.y-r)/(l-r)+h&&(s=!s);const c=a-h,d=l-r,x=((t.x-h)*c+(t.y-r)*d)/(c*c+d*d),u=Math.max(0,Math.min(1,x)),p=h+u*c,b=r+u*d,y=Math.sqrt(Math.pow(t.x-p,2)+Math.pow(t.y-b,2));y<e&&(e=y)}return s?-e:e}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))}class p{constructor(){this.id="",this.group=[],this.pointList=[],this.oldPointList=[],this.label="",this.index=1,this.boxEventIds=[],this.status="draw",this.completeing=!1,this.expent=5,this.mouseDown=!1,this.lastMousePoint={x:0,y:0},this.acctivePointIndex=-1}setLabel(t){this.label=t.label,this.render()}setSelect(t){this.box.selectObject&&(this.box.selectObject.status="done",this.box.selectObject.render(),this.box.selectObject=void 0),this.status=t?"edit":"done",this.box.selectObject=this,this.render(),this.box.emit("onchange")}}class b extends p{constructor(t){super(),this.id=u(),this.minPointCount=2,this.type=L.LINE,this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("onmousemove",this.boxOnPointMove,this),this.box.on_("onmousedown",this.boxOnPointDown,this),this.box.on_("onmouseup",this.boxOnPointUp,this)]}boxOnPointDown(i){return t(this,void 0,void 0,(function*(){if(!this.lastPointDown||!d(i,this.lastPointDown))if(this.box.selectObject){if(this.box.selectObject.id!==this.id||!this.isPointInside(i))return;this.mouseDown=!0,this.lastMousePoint=this.box.lastPoint}else"draw"==this.status&&(this.mouseDown=!0,this.lastPointDown=i,this.pointList[0]=i)}))}boxOnPointMove(t){var i;if(!this.box.selectObject||this.box.selectObject.id==this.id)if(this.mouseDown){if("draw"==this.status&&(this.pointList[1]=t,this.render()),"edit"==this.status&&(null===(i=this.box.selectObject)||void 0===i?void 0:i.id)===this.id){let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):this.pointList[this.acctivePointIndex]={x:this.lastMousePoint.x,y:this.lastMousePoint.y},this.lastMousePoint=this.box.lastPoint,this.render()}}else"edit"==this.status&&(this.acctivePointIndex=a(this.box.lastPoint,this.pointList,this.expent,this.box.t.a),this.render())}boxOnPointUp(){if(this.mouseDown=!1,this.box.selectObject){if(this.box.selectObject.id===this.id?(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=a(this.lastMousePoint,this.pointList,this.expent,this.box.t.a),this.render(),this.box.render()):"draw"!==this.status&&(this.status="done"),"draw"===this.status&&this.box.selectObject.id!==this.id)return this.pointList=[],void this.render()}else"draw"!==this.status&&(this.status="done",this.render());"draw"===this.status&&2===this.pointList.length&&this.complete()}complete(){return t(this,void 0,void 0,(function*(){if(this.pointList.length<this.minPointCount)return;this.completeing=!0;let t=yield new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}))}destory(){this.box.off_(this.boxEventIds),this.pointList=[],this.removeAll()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}get pathData(){let t="";return this.pointList.length&&(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get indexPoint(){return this.pointList[0]}render(){this.removeAll();let t=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(t);let i=this.box.t.a;t.lineWidth=this.box.config.lineWidth/i,t.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color;let s=new Path2D(this.pathData);this.group.push(s),"draw"===this.status&&t.stroke(s),"edit"===this.status&&(this.box.clearCanvas(t),t.lineWidth=this.box.config.lineWidth/i*2,t.stroke(s),this.pointList.map(((s,e)=>{let n=null;n=this.acctivePointIndex===e?new o({ctx:t,center:s,radius:8/i,fillColor:this.box.config.color}):new o({ctx:t,center:s,radius:4/i,fillColor:this.box.config.color}),n.draw(),this.group.push(n)})))}isPointInside(t){let i=this.expent/this.box.t.a;return x(t,this.pointList)<i}export(){return{index:this.index,type:this.type,label:this.label,pointList:this.pointList}}static import(t,i){let s=new this(t);return s.label=i.label,s.pointList=i.pointList,s.status="done",s.render(),s}}class y extends p{constructor(t){super(),this.drag=!1,this.id=u(),this.minPointCount=3,this.type=L.POLYGON,this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("onmousemove",this.boxMousemove,this),this.box.on_("onmousedown",this.boxMousedown,this),this.box.on_("onmouseup",this.boxMouseup,this),this.box.on_("oncontextmenu",this.boxContextmenu,this)]}boxContextmenu(){"draw"===this.status&&(this.pointList.pop(),this.render())}boxMousedown(i){return t(this,void 0,void 0,(function*(){if(!this.lastPointDown||!d(i,this.lastPointDown)){if(this.box.selectObject){if(this.box.selectObject.id!==this.id)return;this.isPointInside(i)&&(this.mouseDown=!0),this.lastMousePoint=this.box.lastPoint}if("draw"==this.status){if(this.lastPointDown=i,this.pointList.length>=3){let t=2,s={x:i.x-this.pointList[0].x,y:i.y-this.pointList[0].y};if(Math.abs(s.x)<4*t&&Math.abs(s.y)<4*t)return void(yield this.complete())}this.pointList.push(i)}}}))}boxMousemove(){if(!this.box.selectObject||this.box.selectObject.id==this.id){if(this.mouseDown&&"edit"==this.status){this.drag=!0;let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):this.pointList[this.acctivePointIndex]={x:this.lastMousePoint.x,y:this.lastMousePoint.y},this.lastMousePoint=this.box.lastPoint}else"edit"==this.status&&(this.acctivePointIndex=a(this.box.lastPoint,this.pointList,this.expent,this.box.t.a));"done"!==this.status&&this.render()}}boxMouseup(){if(this.box.selectObject){if(this.box.selectObject.id===this.id?(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=a(this.lastMousePoint,this.pointList,this.expent,this.box.t.a)):"draw"!=this.status&&(this.status="done"),"draw"===this.status&&this.box.selectObject.id!==this.id)return this.pointList=[],void(this.mouseDown=!1);this.render()}else"edit"===this.status?(this.status="done",this.box.render()):"draw"===this.status&&this.render();this.drag&&"edit"==this.status&&this.box.render(),this.drag=!1,this.mouseDown=!1}destory(){this.box.off_(this.boxEventIds),this.pointList=[],this.removeAll()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}complete(){return t(this,void 0,void 0,(function*(){if(this.pointList.length<this.minPointCount)return;this.completeing=!0;let t=yield new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}))}get pathData(){let t="";return this.pointList.length&&(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get indexPoint(){return this.pointList[0]}render(){this.removeAll();let t=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(t);let i=this.box.t.a;if(t.lineWidth=this.box.config.lineWidth/i,t.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color,"draw"===this.status){let s=this.pathData;this.pointList.length>=2&&(s+=`\n        M${this.pointList[this.pointList.length-1].x},\n        ${this.pointList[this.pointList.length-1].y}\n        L${this.pointList[this.pointList.length-1].x},\n        ${this.pointList[this.pointList.length-1].y} Z`),s+=`L${this.box.lastPoint.x},${this.box.lastPoint.y} Z`;let e=new Path2D(s);this.group.push(e),t.stroke(e),this.pointList.map((s=>{let e=null;e=new o({ctx:t,center:s,radius:4/i,fillColor:this.box.config.color}),this.group.push(e),e.draw()}))}if("edit"===this.status){this.box.clearCanvas(t);let s=new Path2D(this.pathData);this.group.push(s),t.stroke(s),t.fillStyle="edit"===this.status?"rgba(255, 255, 255, 0.5)":"rgba(0,0,0,0)",t.fill(new Path2D(this.pathData)),this.pointList.map(((s,e)=>{let n=null;n=this.acctivePointIndex===e?new o({ctx:t,center:s,radius:8/i,fillColor:this.box.config.color}):new o({ctx:t,center:s,radius:4/i,fillColor:this.box.config.color}),this.group.push(n),n.draw()}))}}isPointInside(t){let i=this.expent/this.box.t.a;return x(t,this.pointList)<i}export(){return{index:this.index,type:this.type,label:this.label,pointList:this.pointList}}static import(t,i){let s=new this(t);return s.label=i.label,s.pointList=i.pointList,s.status="done",s.render(),s}}var L,f;(f=L||(L={})).NONE="",f.RECT="rect",f.POLYGON="polygon",f.CIRCLE="circle",f.ELLIPSE="ellipse",f.SIDES_POLYGON="sides_polygon",f.POINT="point",f.LINE="line",f.POLYLINE="polyline",f.LINE_ARROW="line_arrow";const v={[L.NONE]:"",[L.RECT]:class extends p{constructor(t){super(),this.id=u(),this.minPointCount=2,this.type=L.RECT,this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("onmousemove",this.boxMousemove,this),this.box.on_("onmousedown",this.boxMousedown,this),this.box.on_("onmouseup",this.boxMouseup,this)]}boxMousedown(t){let i=t;"draw"==this.status&&(this.pointList=[i,i],this.mouseDown=!0),this.box.selectObject&&this.box.selectObject.id===this.id&&this.isPointInside(i)&&(this.mouseDown=!0,this.lastMousePoint=this.box.lastPoint)}boxMousemove(){var t;if((!this.box.selectObject||this.box.selectObject.id==this.id)&&1!=this.completeing)if("draw"==this.status&&this.pointList[0]&&(this.pointList[1]=this.box.lastPoint,this.render()),-1!==this.acctivePointIndex&&(this.box.view.style.cursor=["nwse-resize","nesw-resize","nwse-resize","nesw-resize"][this.acctivePointIndex]),(null===(t=this.box.selectObject)||void 0===t?void 0:t.id)===this.id&&this.mouseDown&&"edit"==this.status){let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};if(-1==this.acctivePointIndex)this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y})));else{let t,i=Object.assign({},this.vertexList[this.acctivePointIndex]);0==this.acctivePointIndex?t=Object.assign({},this.vertexList[2]):1==this.acctivePointIndex?t=Object.assign({},this.vertexList[3]):2==this.acctivePointIndex?t=Object.assign({},this.vertexList[0]):3==this.acctivePointIndex&&(t=Object.assign({},this.vertexList[1])),i=Object.assign({},this.box.lastPoint);let s=Math.min(i.x,t.x),e=Math.min(i.y,t.y),o=Math.max(i.x,t.x),n=Math.max(i.y,t.y);this.pointList=[{x:s,y:e},{x:o,y:n}],this.acctivePointIndex=this.vertexList.findIndex((t=>t.x==i.x&&t.y==i.y))}this.lastMousePoint=this.box.lastPoint,this.render()}else"edit"==this.status&&(this.acctivePointIndex=a(this.box.lastPoint,this.vertexList,this.expent,this.box.t.a),this.render())}boxMouseup(){if(this.box.selectObject){if(this.box.selectObject.id!=this.id)return;this.box.selectObject.id===this.id&&(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=a(this.lastMousePoint,this.vertexList,this.expent,this.box.t.a),this.render(),this.box.render())}else"draw"!==this.status&&(this.status="done");if(this.mouseDown=!1,("draw"==this.status||"edit"==this.status)&&2===this.pointList.length){let t=Math.min(this.pointList[0].x,this.pointList[1].x),i=Math.min(this.pointList[0].y,this.pointList[1].y),s=Math.max(this.pointList[0].x,this.pointList[1].x),e=Math.max(this.pointList[0].y,this.pointList[1].y);this.pointList=[{x:t,y:i},{x:s,y:e}]}"draw"==this.status&&2===this.pointList.length&&this.complete()}destory(){this.box.off_(this.boxEventIds),this.pointList=[],this.removeAll()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}complete(){return t(this,void 0,void 0,(function*(){if(this.pointList.length<this.minPointCount)return;if(Math.max(Math.abs(this.pointList[0].x-this.pointList[1].x),Math.abs(this.pointList[0].y-this.pointList[1].y))<30)return this.status="draw",this.pointList=[],void this.render();this.completeing=!0;let t=yield new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}))}get vertexList(){return 2===this.pointList.length?[this.pointList[0],{x:this.pointList[0].x,y:this.pointList[1].y},this.pointList[1],{x:this.pointList[1].x,y:this.pointList[0].y}]:[]}get pathData(){let t="";return this.vertexList.length&&(this.vertexList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t+="Z "),t}get indexPoint(){return this.pointList[0]}render(){this.removeAll();let t=this.box.t.a,i=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(i),i.lineWidth=this.box.config.lineWidth/t,i.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color;let s=new Path2D(this.pathData);this.group.push(s),"draw"===this.status&&i.stroke(s),"edit"===this.status&&(this.box.clearCanvas(i),i.stroke(s),i.fillStyle="edit"===this.status?"rgba(255, 255, 255, 0.5)":"rgba(0,0,0,0)",i.fill(s),this.vertexList.map(((s,e)=>{let n=null;n=this.acctivePointIndex===e?new o({ctx:i,center:s,radius:8/t,fillColor:this.box.config.color}):new o({ctx:i,center:s,radius:4/t,fillColor:this.box.config.color}),n.draw(),this.group.push(n)})))}isPointInside(t){if(!this.pointList.length||"draw"===this.status)return!1;let i=this.expent/this.box.t.a;return x(t,this.vertexList)<i}export(){return{index:this.index,type:this.type,label:this.label,pointList:this.pointList}}static import(t,i){let s=new this(t);return s.label=i.label,s.pointList=i.pointList,s.status="done",s.render(),s}},[L.POLYGON]:y,[L.CIRCLE]:class extends p{constructor(t){super(),this.id=u(),this.minPointCount=2,this.type=L.CIRCLE,this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("onmousemove",this.boxMousemove,this),this.box.on_("onmousedown",this.boxMousedown,this),this.box.on_("onmouseup",this.boxMouseup,this)]}boxMousedown(i){return t(this,void 0,void 0,(function*(){"draw"==this.status&&(this.lastPointDown=i,this.pointList=[i,i],this.mouseDown=!0),this.box.selectObject&&this.box.selectObject.id===this.id&&this.isPointInside(i)&&(this.mouseDown=!0,this.lastMousePoint=this.box.lastPoint)}))}boxMousemove(){var t;if((!this.box.selectObject||this.box.selectObject.id==this.id)&&1!=this.completeing)if("draw"==this.status&&this.pointList[0]&&(this.pointList[1]=this.box.lastPoint,this.render()),1===this.acctivePointIndex&&(this.box.view.style.cursor="col-resize"),(null===(t=this.box.selectObject)||void 0===t?void 0:t.id)===this.id&&this.mouseDown&&"edit"==this.status){let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex||0==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):1==this.acctivePointIndex&&(this.pointList[1]={x:this.pointList[1].x+t.x,y:this.pointList[1].y+t.y}),this.lastMousePoint=this.box.lastPoint,this.render()}else"edit"==this.status&&(this.acctivePointIndex=a(this.box.lastPoint,this.vertexList,this.expent,this.box.t.a),this.render())}boxMouseup(){if(this.box.selectObject){if(this.box.selectObject.id!=this.id)return;this.box.selectObject.id===this.id&&(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=a(this.lastMousePoint,this.vertexList,this.expent,this.box.t.a),this.render(),this.box.render())}else"draw"!==this.status&&(this.status="done");this.mouseDown=!1,"draw"==this.status&&2===this.pointList.length&&this.complete()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}destory(){this.pointList=[],this.removeAll(),this.box.off_(this.boxEventIds)}complete(){return t(this,void 0,void 0,(function*(){if(this.pointList.length<this.minPointCount)return;if(Math.max(Math.abs(this.pointList[0].x-this.pointList[1].x),Math.abs(this.pointList[0].y-this.pointList[1].y))<30)return this.status="draw",this.pointList=[],void this.render();this.completeing=!0;let t=yield new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}))}get vertexList(){return 2===this.pointList.length?[this.pointList[0],this.pointList[1]]:[]}get pathData(){let t="";if(this.pointList.length){let i={x:2*this.pointList[0].x-this.pointList[1].x,y:2*this.pointList[0].y-this.pointList[1].y},s=c(this.pointList[0],this.pointList[1]);t+=`\n          M ${i.x} ${i.y} \n          A ${s} ${s} 0 0 1 ${this.pointList[1].x} ${this.pointList[1].y}\n          A ${s} ${s} 0 0 1 ${i.x} ${i.y}\n        `,t+="Z "}return t}get indexPoint(){return this.pointList[1]}render(){this.removeAll();let t=this.box.t.a,i=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(i),i.lineWidth=2/t,i.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color;let s=new Path2D(this.pathData);this.group.push(s),"draw"===this.status&&i.stroke(s),"edit"==this.status&&(this.box.clearCanvas(i),i.stroke(s),i.fillStyle="edit"===this.status?"rgba(255, 255, 255, 0.5)":"rgba(0,0,0,0)",i.fill(s),this.vertexList.map(((s,e)=>{let n=null;0!==e&&(n=this.acctivePointIndex===e?new o({ctx:i,center:s,radius:8/t,fillColor:this.box.config.color}):new o({ctx:i,center:s,radius:4/t,fillColor:this.box.config.color}),n.draw(),this.group.push(n))})))}isPointInside(t){let i=this.expent/this.box.initLayout.zoom;if(!this.pointList.length||"draw"===this.status)return!1;let s=Math.sqrt(Math.pow(this.pointList[0].x-t.x,2)+Math.pow(this.pointList[0].y-t.y,2)),e=c(this.pointList[0],this.pointList[1]);return s<=e+i&&0!==e}export(){return{index:this.index,type:this.type,label:this.label,pointList:this.pointList}}static import(t,i){let s=new this(t);return s.label=i.label,s.pointList=i.pointList,s.status="done",s.render(),s}},[L.ELLIPSE]:class extends p{constructor(t){super(),this.id=u(),this.minPointCount=2,this.type=L.ELLIPSE,this.box=t,this.index=t.markObjectList.length+1,this.boxEventIds=[this.box.on_("onmousemove",this.boxOnPointMove,this),this.box.on_("onmousedown",this.boxOnPointDown,this),this.box.on_("onmouseup",this.boxOnPointUp,this)]}boxOnPointDown(i){return t(this,void 0,void 0,(function*(){"draw"==this.status&&(this.lastPointDown=i,this.pointList=[i,i],this.mouseDown=!0),this.box.selectObject&&this.box.selectObject.id===this.id&&this.isPointInside(i)&&(this.mouseDown=!0,this.lastMousePoint=this.box.lastPoint)}))}boxOnPointMove(){var t;if((!this.box.selectObject||this.box.selectObject.id==this.id)&&1!=this.completeing)if("draw"==this.status&&this.pointList[0]&&(this.pointList[1]=this.box.lastPoint,this.render()),[0,2].includes(this.acctivePointIndex)?this.box.view.style.cursor="col-resize":[1,3].includes(this.acctivePointIndex)&&(this.box.view.style.cursor="row-resize"),(null===(t=this.box.selectObject)||void 0===t?void 0:t.id)===this.id&&this.mouseDown&&"edit"==this.status){let t={x:this.box.lastPoint.x-this.lastMousePoint.x,y:this.box.lastPoint.y-this.lastMousePoint.y};-1==this.acctivePointIndex?this.pointList=this.pointList.map((i=>({x:i.x+t.x,y:i.y+t.y}))):0===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x-t.x,y:this.pointList[1].y}:1===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x,y:this.pointList[1].y+t.y}:2===this.acctivePointIndex?this.pointList[1]={x:this.pointList[1].x+t.x,y:this.pointList[1].y}:3===this.acctivePointIndex&&(this.pointList[1]={x:this.pointList[1].x,y:this.pointList[1].y-t.y}),this.lastMousePoint=this.box.lastPoint,this.render()}else"edit"==this.status&&(this.acctivePointIndex=a(this.box.lastPoint,this.vertexList,this.expent,this.box.t.a),this.render())}boxOnPointUp(){if(this.mouseDown&&"edit"==this.status&&this.acctivePointIndex>-1&&(this.box.selectObject=this),this.box.selectObject){if(this.box.selectObject.id!=this.id)return;this.box.selectObject.id===this.id&&(this.status="edit",this.lastMousePoint=this.box.lastPoint,this.acctivePointIndex=this.acctivePointIndex=a(this.lastMousePoint,this.vertexList,this.expent,this.box.t.a),this.render(),this.box.render())}else"draw"!==this.status&&(this.status="done");this.mouseDown=!1,"draw"==this.status&&2===this.pointList.length&&this.complete()}removeAll(){for(var t=0;t<this.group.length;t++)this.group[t]=null;this.group=[]}destory(){this.pointList=[],this.removeAll(),this.box.off_(this.boxEventIds)}complete(){return t(this,void 0,void 0,(function*(){if(this.pointList.length<this.minPointCount)return;if(Math.max(Math.abs(this.pointList[0].x-this.pointList[1].x),Math.abs(this.pointList[0].y-this.pointList[1].y))<30)return this.status="draw",this.pointList=[],void this.render();this.completeing=!0;let t=yield new Promise(((t,i)=>{this.box.emit("oncomplete",{ok:t,err:i})})).catch((()=>{this.completeing=!1,this.pointList=[],this.render()}));t&&(this.completeing=!1,this.label=null==t?void 0:t.label,this.status="done",this.render(),this.box.render(),this.box.addObjectData())}))}get vertexList(){if(2===this.pointList.length){let t=this.pointList[1].x-this.pointList[0].x,i=this.pointList[1].y-this.pointList[0].y;return[{x:this.pointList[0].x-t,y:this.pointList[0].y},{x:this.pointList[0].x,y:this.pointList[0].y+i},{x:this.pointList[1].x,y:this.pointList[1].y-i},{x:this.pointList[0].x,y:this.pointList[0].y-i}]}return[]}get ellipseData(){if(2===this.pointList.length){let t=Math.abs(this.pointList[1].x-this.pointList[0].x),i=Math.abs(this.pointList[1].y-this.pointList[0].y);return{pointList:this.pointList[0],xr:t,yr:i}}return null}get indexPoint(){return this.vertexList[1]}get pathData(){let t="";if(this.pointList.length){let i=Math.abs(this.pointList[1].x-this.pointList[0].x),s=Math.abs(this.pointList[1].y-this.pointList[0].y);t+=`\n        M ${this.vertexList[0].x} ${this.vertexList[0].y} \n        A ${i} ${s} 0 0 1 ${this.vertexList[2].x} ${this.vertexList[2].y}\n        A ${i} ${s} 0 0 1 ${this.vertexList[0].x} ${this.vertexList[0].y}\n      `,t+="Z "}return t}render(){this.removeAll();let t=this.box.t.a,i=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(i),i.lineWidth=2/t,i.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color;let s=new Path2D(this.pathData);this.group.push(s),"draw"===this.status&&i.stroke(s),"edit"==this.status&&(this.box.clearCanvas(i),i.stroke(s),i.fillStyle="edit"===this.status?"rgba(255, 255, 255, 0.5)":"rgba(0,0,0,0)",i.fill(s),this.vertexList.map(((s,e)=>{let n=null;n=this.acctivePointIndex===e?new o({ctx:i,center:s,radius:8/t,fillColor:this.box.config.color}):new o({ctx:i,center:s,radius:4/t,fillColor:this.box.config.color}),n.draw(),this.group.push(n)})))}isPointInside(t){if(!this.pointList.length||"draw"===this.status)return!1;const{xr:i,yr:s,pointList:e}=this.ellipseData;return Math.pow(t.x-e.x,2)/Math.pow(i,2)+Math.pow(t.y-e.y,2)/Math.pow(s,2)<=1||a(t,this.vertexList,this.expent,this.box.t.a)>-1}export(){return{index:this.index,type:this.type,label:this.label,pointList:this.pointList}}static import(t,i){let s=new this(t);return s.label=i.label,s.pointList=i.pointList,s.status="done",s.render(),s}},[L.SIDES_POLYGON]:class extends y{constructor(t){super(t),this.type=L.SIDES_POLYGON}get pathData(){let t="";if(this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),this.pointList.length>=2){const[i,s]=((t,i)=>{const{x:s,y:e}=t,{x:o,y:n}=i;return[{x:(s+o)/2-(e-n)/6,y:(e+n)/2+(s-o)/6},{x:(s+o)/2+(e-n)/6,y:(e+n)/2-(s-o)/6}]})(this.pointList[0],this.pointList[1]),[e,o]=l(s,i,20/this.box.t.a);t+="Z",t+=`M${s.x},${s.y}`,t+=`L${i.x},${i.y}`,t+="Z",t+=`M${e.x},${e.y}`,t+=`L${i.x},${i.y}`,t+=`M${i.x},${i.y}`,t+=`L${o.x},${o.y}`,t+="Z",t+=`M${this.pointList[0].x},${this.pointList[0].y}`,t+=`L${this.pointList[1].x},${this.pointList[1].y}`,t+=`L${this.pointList[0].x},${this.pointList[0].y} `,t+=`L${this.pointList[this.pointList.length-1].x},${this.pointList[this.pointList.length-1].y} `}return t+="Z ",t}},[L.POLYLINE]:class extends y{constructor(t){super(t),this.type=L.POLYLINE}get pathData(){let t="";return this.pointList.length&&this.pointList.forEach(((i,s)=>{t+=0===s?`M${i.x},${i.y}`:`L${i.x},${i.y}`})),t}render(){this.removeAll();let t=this.box.regionCtx;this.box.selectObject||this.box.clearCanvas(t);let i=this.box.t.a;if(t.lineWidth=this.box.config.lineWidth/i,t.strokeStyle="draw"===this.status?this.box.config.drawColor:this.box.config.color,"draw"===this.status){let s=this.pathData;s+=`L${this.box.lastPoint.x},${this.box.lastPoint.y}`;let e=new Path2D(s);this.group.push(e),t.stroke(e),this.pointList.map((s=>{let e=null;e=new o({ctx:t,center:s,radius:4/i,fillColor:this.box.config.color}),this.group.push(e),e.draw()}))}if("edit"===this.status){this.box.clearCanvas(t);let s=new Path2D(this.pathData);this.group.push(s),t.stroke(s),t.fillStyle="edit"===this.status?"rgba(255, 255, 255, 0.5)":"rgba(0,0,0,0)",t.fill(s),this.pointList.map(((s,e)=>{let n=null;n=this.acctivePointIndex===e?new o({ctx:t,center:s,radius:8/i,fillColor:this.box.config.color}):new o({ctx:t,center:s,radius:4/i,fillColor:this.box.config.color}),this.group.push(n),n.draw()}))}}},[L.LINE]:b,[L.LINE_ARROW]:class extends b{constructor(t){super(t),this.type=L.LINE_ARROW}get pathData(){let t="";if(this.pointList.length){if(2===this.pointList.length){t+=`M${this.pointList[0].x},${this.pointList[1].y}`,t+=`L${this.pointList[0].x},${this.pointList[1].y}`;const[i,s]=this.pointList,[e,o]=l(i,s,20/this.box.t.a);t+="Z",t+=`M${i.x},${i.y}`,t+=`L${s.x},${s.y}`,t+="Z",t+=`M${e.x},${e.y}`,t+=`L${s.x},${s.y}`,t+=`M${s.x},${s.y}`,t+=`L${o.x},${o.y}`,t+="Z"}t+="Z "}return t}}},{scaleOfOuter:m}=h;let g=class{constructor(t){this.config={color:"red",drawColor:"yellow",lineWidth:2},this.t={a:1,b:0,c:0,d:1,e:0,f:0},this.initLayout={zoom:1,offsetx:0,offsety:0,width:0,height:0},this.lastMovePoint={x:0,y:0},this.moveStatus=!1,this.mouseDown=!1,this.drag=!1,this.currentDrawingType=L.NONE,this.markObjectList=[],this._events=Object.create(null),this.init(t)}init(t){Object.assign(this.config,t||{}),this.view=document.querySelector(t.view),this.view.style.overflow="hidden",this.view.style.position="relative",this.view.style.cursor="default",this.canvas=this.createCanvas(),this.regionCanvas=this.createCanvas(),this.ctx=this.canvas.getContext("2d"),this.regionCtx=this.regionCanvas.getContext("2d"),this.view.addEventListener("mousemove",this.appMousemove.bind(this)),this.view.addEventListener("mousedown",this.appMousedown.bind(this)),this.view.addEventListener("mouseup",this.appMouseup.bind(this)),this.view.addEventListener("wheel",this.appWheel.bind(this)),this.view.addEventListener("dblclick",this.appDblclick.bind(this)),this.view.addEventListener("contextmenu",(t=>{t.preventDefault(),this.emit("oncontextmenu",this.lastMovePoint)})),this.windowKeydown=this.windowKeydown.bind(this),this.windowKeyup=this.windowKeyup.bind(this),window.addEventListener("keydown",this.windowKeydown),window.addEventListener("keyup",this.windowKeyup)}get viewDomInfo(){return this.view.getBoundingClientRect()}get lastPoint(){return this.lastMovePoint?this.lastMovePoint:null}createCanvas(){let t=document.createElement("canvas");return t.setAttribute("style",` width: ${this.viewDomInfo.width}px;\n        height: ${this.viewDomInfo.height}px;\n        position: absolute;\n        `),t.width=this.viewDomInfo.width,t.height=this.viewDomInfo.height,this.view.appendChild(t),t}clearCanvas(t){t.save(),t.globalCompositeOperation="copy",t.beginPath(),t.lineTo(0,0),t.stroke(),t.restore()}clearMarkShapes(){this.markObjectList.forEach((t=>{t.destory(),t.render()})),this.markObjectList=[],this.render(),this.emit("onchange"),this.addObjectData()}setBackground(i){return t(this,void 0,void 0,(function*(){return new Promise((t=>{var s;(null===(s=this.img)||void 0===s?void 0:s.src)?this.img.src=i:(this.img=new Image,this.img.src=i,this.img.style.position="absolute",this.img.style.userSelect="none"),this.img.onload=()=>{this.view.insertBefore(this.img,this.canvas),this.setLayout(this.img),t(null)}}))}))}transfrom(){var t;this.ctx.setTransform(this.t),this.regionCtx.setTransform(this.t),this.img&&this.imgTrans(),null===(t=this.selectObject)||void 0===t||t.render(),this.render(),this.emit("ontransform",{t:this.t})}setLayout({width:t,height:i}){let s=this.viewDomInfo.width/t,e=this.viewDomInfo.height/i,o=Math.min(s,e),n=(this.viewDomInfo.width-t*o)/2,h=(this.viewDomInfo.height-i*o)/2;this.t={a:o,b:0,c:0,d:o,e:n,f:h},this.initLayout={zoom:o,offsetx:n,offsety:h,width:t,height:i},this.transfrom()}imgTrans(){this.img.style.transformOrigin=`${this.t.e}px ${this.t.f}px`,this.img.style.transform=`scale(${this.t.a}) translate(${this.t.e}px,${this.t.f}px)`}render(){this.clearCanvas(this.ctx);let t="";this.ctx.strokeStyle=this.config.color,this.ctx.fillStyle=this.config.color,this.ctx.font=`bold ${~~(16/this.t.a)}px serif`,this.markObjectList.map(((i,s)=>{"draw"!==i.status&&this.ctx.fillText(s+"",i.indexPoint.x,i.indexPoint.y-3/this.t.a),t+=i.pathData})),this.ctx.lineWidth=2/this.t.a,this.ctx.stroke(new Path2D(t))}destroy(){window.removeEventListener("keydown",this.windowKeydown),window.removeEventListener("keyup",this.windowKeyup),this.view.innerHTML="",this.view.replaceWith(this.view.cloneNode(!0))}appWheel(t){if(t.metaKey||t.ctrlKey||t.altKey){t.preventDefault();const i={x:t.offsetX,y:t.offsetY};let s=t.deltaY>0?.9:1.1;m(this.t,i,s,s),this.transfrom()}}appDblclick(){this.t={a:this.initLayout.zoom,b:0,c:0,d:this.initLayout.zoom,e:this.initLayout.offsetx,f:this.initLayout.offsety},this.transfrom()}appMoving(t){this.view.style.cursor="grab";let i=(t.x-this.lastMovePoint.x)*this.t.a,s=(t.y-this.lastMovePoint.y)*this.t.a;this.t.e+=i,this.t.f+=s,this.transfrom(),this.emit("onmove",{status:this.moveStatus})}appMousemove(t){let i=this.pointMapping(t);if(this.mouseDown&&this.moveStatus)return this.appMoving(i),void(this.lastMovePoint=this.pointMapping(t));this.view.style.cursor="default",!!this.markObjectList.find((t=>"draw"===t.status))&&(this.view.style.cursor="crosshair"),this.mouseDown&&this.selectObject&&(this.drag=!0,this.view.style.cursor="move"),void 0!==t.buttons&&(this.lastMovePoint={x:i.x,y:i.y}),this.emit("onmousemove",i)}appMousedown(t){let i=this.pointMapping(t);this.mouseDown=!0,this.moveStatus||1===t.buttons&&this.emit("onmousedown",i)}appMouseup(t){var i,s,e,o,n,h,r;if(this.mouseDown=!1,this.moveStatus)return;let a=this.pointMapping(t);if(this.selectObject&&this.drag)return this.selectObject.isPointInside(a)||(this.selectObject=void 0),this.drag=!1,this.emit("onmouseup",a),void this.emit("onchange");let l=this.markObjectList[this.markObjectList.length-1];if("draw"===l.status&&l.pointList&&(null===(i=this.lastMovePoint)||void 0===i?void 0:i.x)!==(null===(e=null===(s=null==l?void 0:l.pointList)||void 0===s?void 0:s[0])||void 0===e?void 0:e.x)&&l.pointList.length>0&&(null===(n=null===(o=null==l?void 0:l.pointList)||void 0===o?void 0:o[0])||void 0===n?void 0:n.x)!==(null===(r=null===(h=null==l?void 0:l.pointList)||void 0===h?void 0:h[1])||void 0===r?void 0:r.x))this.selectObject=void 0;else{let t=this.getSelectedIndex(a);void 0!==t&&this.markObjectList[t]?(this.drag&&this.selectObject&&this.selectObject.id!==this.markObjectList[t].id||(this.selectObject=this.markObjectList[t]),"draw"===this.markObjectList[t].status&&(this.selectObject=void 0)):this.selectObject=void 0}this.moveStatus=!1,this.mouseDown=!1,this.drag=!1,this.emit("onmouseup",a),this.emit("onchange")}pointMapping(t){let i={x:0,y:0},s=t.offsetX||t.x,e=t.offsetY||t.y;return i.x=(s-this.t.e)/this.t.a,i.y=(e-this.t.f)/this.t.a,i}getSelectedIndex(t){let i=this.markObjectList.map(((t,i)=>i)).reverse().filter((i=>this.markObjectList[i].isPointInside(t)));if(i.length){if(1===i.length)return i[0];if(i.length>1){if(this.drag&&this.selectObject)return this.selectObject.index-1;if(this.selectObject){const t=this.selectObject.index-1;if(i.indexOf(t)>-1)return i[i.indexOf(t)+1]}if(!this.selectObject)return i[0]}}}setDrawType(i){return t(this,void 0,void 0,(function*(){if(this.currentDrawingType){let t=this.markObjectList[this.markObjectList.length-1];t&&"draw"===t.status&&(null==t||t.destory(),this.markObjectList.pop())}this.currentDrawingType=i,this.addObjectData(),this.emit("ondraw",{type:i})}))}get objects(){return this.markObjectList.filter((t=>"draw"!==t.status)).map((t=>{var i;return{id:t.id,label:t.label,type:t.type,select:t.id===(null===(i=this.selectObject)||void 0===i?void 0:i.id),pointList:t.pointList}}))}addObjectData(){let t=null;if(this.currentDrawingType)try{t=new v[this.currentDrawingType](this)}catch(i){throw new Error(`${this.currentDrawingType} mark type is not supported`)}t&&this.markObjectList.push(t),this.emit("onchange")}setObjectData(t){t.forEach((t=>{let i;if(t.type)try{i=v[t.type].import(this,t)}catch(s){throw new Error(`${t.type} mark type is not supported`)}i&&this.markObjectList.push(i)})),this.render(),this.emit("onchange")}setObjectLabel(t,i){let s=this.markObjectList.find((i=>i.id===t));s&&s.setLabel(i)}selectObjectById(t){let i=this.markObjectList.find((i=>i.id===t));i&&i.setSelect(!0)}deleteObject(t){var i;let s=this.markObjectList.find((i=>i.id===t));s&&(s.destory(),null===(i=this.selectObject)||void 0===i||i.render(),this.markObjectList.splice(this.markObjectList.indexOf(s),1),this.render(),this.emit("onchange"))}setMoveStatus(t){this.moveStatus!=t&&(this.moveStatus=t)}windowKeydown(i){return t(this,void 0,void 0,(function*(){if("Space"==i.code&&(this.setMoveStatus(!0),i.preventDefault()),"NumpadEnter"==i.code||"Enter"==i.code){let t=this.markObjectList[this.markObjectList.length-1];"draw"==(null==t?void 0:t.status)&&(yield t.complete())}"Delete"==i.code&&this.selectObject&&this.deleteObject(this.selectObject.id)}))}windowKeyup(t){"Space"==t.code&&this.setMoveStatus(!1)}on(t,i){}on_(t,i,s){return{}}off(t,i){}off_(t){}emit(t,...i){}};var w;g=function(t,i,s,e){var o,n=arguments.length,h=n<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,i,s,e);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(h=(n<3?o(h):n>3?o(i,s,h):o(i,s))||h);return n>3&&h&&Object.defineProperty(i,s,h),h}([(w=i,t=>{var i;(w.prototype?(i=w.prototype,Object.getOwnPropertyNames(i)):Object.keys(w)).forEach((i=>{if(!s.includes(i))if(w.prototype){(e=w.prototype,o=i,Object.getOwnPropertyDescriptor(e,o)).writable&&(t.prototype[i]=w.prototype[i])}else t.prototype[i]=w[i];var e,o}))})],g);var P=g;const O=""+new URL("image-etDKo1Lq.jpg",import.meta.url).href,M=[{id:"f9e1cf23-8903-4f40-8ff9-724363190272",label:"person",type:"polygon",pointList:[{x:257.7016248153619,y:189.06942392909895},{x:380.5967503692762,y:191.90546528803543},{x:520.5081240768095,y:191.90546528803543},{x:768.1890694239291,y:192.85081240768093},{x:760.6262924667651,y:222.15657311669128},{x:633.0044313146234,y:225.93796159527326},{x:632.0590841949778,y:257.13441654357456},{x:257.7016248153619,y:260.9158050221566}]},{id:"f414b029-1311-43f8-b2e5-fa0508ce5740",label:"women",type:"rect",pointList:[{x:653.8020679468241,y:251.4623338257016},{x:770.07976366322,y:287.3855243722304}]},{id:"b420899a-1488-4885-97a2-c9c4131a08e2",label:"home",type:"circle",pointList:[{x:80.92171344165445,y:460.384047267356},{x:40.27178729689808,y:424.4608567208272}]},{id:"f0b68f67-7af1-4a69-8502-774ab07676cf",label:"cloud",type:"ellipse",pointList:[{x:144.25997045790254,y:302.51107828655836},{x:232.1772525849335,y:326.1447562776957}]},{id:"b2e9e160-ae8b-4992-a832-6423af623764",label:"person",type:"line",pointList:[{x:126.29837518463813,y:349.77843426883305},{x:576.2836041358936,y:345.0516986706056}]},{id:"9aff9994-991e-44fe-b67e-7b57f31f751f",label:"arrow",type:"line_arrow",pointList:[{x:129.13441654357462,y:66.17429837518463},{x:254.8655834564254,y:162.59970457902511}]},{id:"bb3f20df-1594-4dc8-b3e5-1262a4ae8ea6",label:"person",type:"polyline",pointList:[{x:849.4889217134416,y:42.540620384047266},{x:944.9689807976366,y:127.62186115214179},{x:814.5110782865584,y:160.7090103397341}]}];window.onload=function(){var t;document.getElementById("upload").onclick=function(){var i=document.createElement("input");i.type="file",i.accept="image/*",i.onchange=function(i){var s=i.target.files[0];if(s){var e=new FileReader;e.onload=function(i){null==t||t.setBackground(i.target.result).then((function(){t.setDrawType(t.currentDrawingType||"rect")}))},e.readAsDataURL(s)}},i.click()},document.getElementById("clear").onclick=function(){t.clearMarkShapes()},document.getElementById("importJson").onclick=function(){t.setObjectData(M)},document.getElementById("creact").onclick=n,document.getElementById("destroy").onclick=function(){t.destroy(),t=void 0};var i=[],s=document.querySelector("#labelInput"),e=document.querySelector("#textarea"),o=s.value;function n(){t||(null==(t=new P({view:"#mark-box"}))||t.setBackground(O).then((function(){t.setDrawType(t.currentDrawingType||"rect")})),t.on("ondraw",(function(i){t.currentDrawingType=i.type})),t.on("oncomplete",(function(t){t.ok({label:o})})),t.on("onchange",(function(){i=t.objects,function(){var s=document.getElementById("mark-list"),e=[];e.push("<ul id='mark-list-ul'>");for(var o=0;o<i.length;o++){var n=i[o].label;e.push("<li>\n        ".concat(n,"\n      <button data-type='del' data-id=").concat(i[o].id,">删除</button>\n      </li>"))}e.push("</ul>"),s.innerHTML=e.join(""),document.getElementById("mark-list-ul").onclick=function(i){if(i.target.dataset.type&&"del"===i.target.dataset.type)t.deleteObject(i.target.dataset.id)}}(),e.value=JSON.stringify(i)})))}s.onchange=function(t){o=t.target.value},n(),document.querySelector(".mark-operate").onclick=function(i){i.target.dataset.type&&t.setDrawType(i.target.dataset.type)}};
